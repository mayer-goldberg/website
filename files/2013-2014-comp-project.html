<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Final Project (Due: Tuesday, February 4, 2014, at 12:00pm)</title>
<!-- 2014-01-23 Thu 11:47 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="author" content="Mayer Goldberg"/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="shortcut icon" type="image/x-icon" href="http://www.little-lisper.org/website/favicon.ico" />
<link rel="apple-touch-icon" type="image/x-icon" href="http://www.little-lisper.org/website/favicon.png" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Final Project (Due: Tuesday, February 4, 2014, at 12:00pm)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Overview</a></li>
<li><a href="#sec-2">2. Writing the code generator</a>
<ul>
<li><a href="#sec-2-1">2.1. The target language</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Integration</a></li>
<li><a href="#sec-4">4. Run-time support</a></li>
<li><a href="#sec-5">5. How to submit</a>
<ul>
<li><a href="#sec-5-1">5.1. Last minute instructions</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
This is the final project in the compiler construction course. Your tasks for the project consists of doing the following:
</p>

<ul class="org-ul">
<li>Writing a code generator to a CISC-like assembly language. 
</li>
<li>Integrating the various states in the compiler pipeline, into a complete compiler. As part of this, you will define a procedure <code>compile_scheme_file(source, target)</code>, that takes two strings, the name of a Scheme source file, and the name of a target assembly file, read each expression in the Scheme source file, tag-parse it, perform the semantic analysis over it, generate assembly code for it, and write that code into the target assembly file. 
</li>
<li>Writing the run-time support: library of built-in Scheme procedures that will be available with your compiler. 
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Writing the code generator</h2>
<div class="outline-text-2" id="text-2">
<p>
Define the instance method <code>code_gen(self)</code> in <code>AbstractSchemeExpr</code>, so that when invoked from a Scheme expression <code>e</code>, returns a string of assembly language instructions in the CISC-like architecture <i>arch</i> posted to the website.
</p>

<p>
The object-oriented way to implement <code>code_gen(self)</code> would be to add an implementation in most of the classes that inherit from <code>AbstractSchemeExpr</code>. If you use the <i>visitor pattern</i> then you may want to implement a <code>CodeGenVisitor</code> class that implements the code generation functionality per class. 
</p>

<p>
You are free to generate any valid <i>arch</i> code, but you are advised to follow the outline of the code generator presented in class. 
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> The target language</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The target language, i.e., the language that your code generator will output, is supposed to model a generic CISC-like assembly language for a general register architecture. What this means is that you have a relatively large number of general purpose registers that can all be used for arithmetic, logical and memory operations. The instruction set provides you with operations for computing sums, differences, products, quotients, remainders, bitwise Boolean operations, simple conditionals, branches and subroutines:
</p>

<ul class="org-ul">
<li><b>Registers.</b> The <code>cisc.h</code> file, which defines our microarchitectural, specifies 16 general-purpose registers. Sixteen registers is a reasonable number; We have certainly used less than a half of these, and you may add as many more as you like. , We also have the stack pointer <code>SP</code>, the frame pointer <code>FP</code>. You may define the stack size to be whatever you like, but  <code>Mega(64)</code> seems to be a reasonable starting point.
</li>

<li><b>Arithmetic Operations.</b> 
</li>
</ul>
<p>
You may carry out arithmetic operations between registers and registers or between registers and constants. <b>No nesting of operations is permitted</b>, so, for example, you can have <code>MOV(R0, R3)</code> or <code>ADD(R4, R3)</code>, but you may not have something like <code>MOV(R0, ADD(R3, R5))</code>, etc.
</p>

<ul class="org-ul">
<li><b>Branches, Subroutines, Labels.</b>
</li>
</ul>
<p>
You can define any number of labels, and branch to any label. A label in C is defined as a name followed by a colon (e.g., <code>L34:</code>). As a rule of thumb, any name that would qualify as a variable or procedure name could also be used as a label. The commands <code>JUMP</code>, <code>JUMP_condition</code>, <code>CALL</code>, <code>CALLA</code>, <code>RETURN</code>, as well as other commands documented in the manual are available for jumping to labels, calling &amp; returning from subroutines. Consult the documentation &amp; code examples for more details.
</p>

<p>
As mentioned in class, unlike the situation in assembly language, labels in C are <i>symbolic</i> entities and have no addresses. The <i>gcc</i> compiler introduces a non-standard <i>extension</i>, in which the address of a label can be found via <code>&amp;&amp;LabelName</code>, and is a datum of type <code>void *</code>. Correspondingly, jumping to an <i>address</i>, as opposed to a label, is accomplished by means of another non-standard extension: <code>goto *addr</code>. 
</p>

<p>
Our microarchitecture makes extensive use of these extensions to the C standard. This means that this part of the project cannot be done in a compiler other than <i>gcc</i>. This compiler is available on the departmental Unix and Linux machines, comes as the default C compiler on Linux &amp; OSX, <b>and can be downloaded and used under Windows.</b> For information on how to get <i>gcc</i> for Windows, please consult the course syllabus.
</p>

<ul class="org-ul">
<li><b>Conditionals.</b> 
</li>
</ul>
<p>
Consult the documentation of the <i>cisc</i> microarchitecture, as well as the sample library, for information on all the conditions that can be tested, and how to use them.
</p>

<ul class="org-ul">
<li><b>Stack Operations.</b>
</li>
</ul>
<p>
Consult the documentation of the <i>cisc</i> microarchitecture, as well as the sample library, for information on the structure of the stack, the frame, the <code>FPARG</code> and <code>STARG</code> macros, and how to use them. 
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Integration</h2>
<div class="outline-text-2" id="text-3">
<p>
In this part of the project, you will implement the <b>global procedure</b> <code>compile_scheme_file(source, target)</code>, that takes two strings, the name of a Scheme source file, and the name of a target assembly file, read each expression in the Scheme source file, tag-parse it, perform the semantic analysis over it, generate assembly code for it, and write that code into the target assembly file. After evaluation, the value should be printed to stdout unless it is <code>#&lt;void&gt;</code>, in which case, do not print it. If the value of an expression <i>contains</i> <code>#&lt;void&gt;</code>, then and only then is the void object printed within the larger resulting value. 
</p>

<p>
You should be able to invoke it from the Python prompt as follows:
</p>

<div class="org-src-container">

<pre class="src src-python">&gt;&gt;&gt; compile_scheme_file('test1.scm', 'test1.asm') 
&gt;&gt;&gt; compile_scheme_file('test2.scm', 'test2.asm') 
&gt;&gt;&gt; compile_scheme_file('test3.scm', 'test3.asm')
</pre>
</div>

<p>
You should provide a <i>makefile</i> that can be used to compile the target assembly language file to a standalone executable. You should do this by writing a <i>makefile rule</i> that will describe how to convert files with the <code>.asm</code> suffix to files with no suffix. Please check the online documentation of the <i>make</i> utility for an explanation as to how to do this. Basically, you will need to teach <i>make</i> to recognize the new suffix:
</p>

<div class="org-src-container">

<pre class="src src-makefile">.SUFFIXES: .asm
</pre>
</div>

<p>
Then you will need to define the rule:
</p>

<div class="org-src-container">

<pre class="src src-makefile">%:      %.asm
	...
</pre>
</div>

<p>
Where <code>...</code> should be replaced by appropriate invocations of <i>gcc</i>. 
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Run-time support</h2>
<div class="outline-text-2" id="text-4">
<p>
Certain elementary procedures need to be available for the users of your compiler. These "built-in" procedures need to be hand-written, in assembly language. These include:
</p>

<p>
<code>apply</code>, <code>&lt;</code> (variadic), = (variadic), <code>&gt;</code> (variadic), <code>+</code> (variadic), <code>/</code> (variadic), <code>*</code> (variadic), <code>-</code> (variadic), <code>boolean?</code>, <code>car</code>, <code>cdr</code>, <code>char-&gt;integer</code>, <code>char?</code>, <code>cons</code>, <code>eq?</code>, <code>integer?</code>, <code>integer-&gt;char</code>, <code>list</code>, <code>make-string</code>, <code>make-vector</code>, <code>map</code>, <code>null?</code>, <code>number?</code>, <code>pair?</code>, <code>procedure?</code>, <code>remainder</code>, <code>string-length</code>, <code>string-ref</code>, <code>string-&gt;symbol</code>, <code>string?</code>, <code>symbol?</code>, <code>symbol-&gt;string</code>, <code>vector</code>, <code>vector-length</code>, <code>vector-ref</code>, <code>vector?</code>, <code>zero?</code>.
</p>

<p>
You will also need to make the procedure <code>Yag</code> available to your users, so that the expansion of <code>letrec</code> works correctly. You may either re-implement it in assembly, or simply catenate the following source code with (and before!) any user code:
</p>

<div class="org-src-container">

<pre class="src src-scheme">(define Yag
  (lambda fs
    (let ((ms (map
		(lambda (fi)
		  (lambda ms
		    (apply fi (map (lambda (mi)
				     (lambda args
				       (apply (apply mi ms) args))) ms))))
		fs)))
      (apply (car ms) ms))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> How to submit</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>You should submit a <i>zip</i> file <code>project.zip</code> that creates a directory <code>project</code> containing:
</li>
<li><code>scheme-compiler</code>
<ul class="org-ul">
<li><code>pc.py</code>
</li>
<li><code>sexprs.py</code>
</li>
<li><code>reader.py</code>
</li>
<li><code>tag_parser.py</code>
</li>
<li><code>compiler.py</code>
</li>
<li><code>arch</code> 
</li>
<li><code>makefile</code>
</li>
<li><i>Any additional files needed to compile and run Scheme code</i>
</li>
</ul>
</li>
<li>A file <code>readme.txt</code> that contains the names, IDs, and email addresses of all group members (you may either work alone, or with a single partner), as well as the following statement:
</li>
</ul>
<blockquote>
<p>
I(We), &lt;fill in your name(s)&gt;, declare the following to be true:
</p>
<ul class="org-ul">
<li>We worked on this assignment alone. We did not consult with others about this assignment, other than the teaching staff for this course.
</li>
<li>We did not copy code either from other students or from the internet.
</li>
<li>We did not make available this code to other students taking this course.
</li>
<li>We are aware of the University, faculty (as specified in the &rlm;שנתון&lrm;), departmental, and course policies (as specified in the syllabus) on academic dishonesty: We realize that if we are found to have committed academic dishonesty that we shall be sent before the disciplinary committee (&rlm;ועדת משמעת&lrm;), fail the course, and possibly incur other penalties as decided by the disciplinary committee. 
</li>
</ul>
</blockquote>

<p>
We will not grade any work submitted that does not include the above statement. Please do not forget to include it, with your names spelled out. If you do not do this, for any reason, then at the very least, you will incur the 5% per diem late penalty (as specified in the course syllabus). 
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Last minute instructions</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li><b>This is it, folks:</b> This is your last programming assignment in the course. Please make sure <b>everything</b> necessary to compile and run Scheme code is included. Please be <b>very pedantic</b> about it: Create a new directory, unpack your <i>zip</i> file there, and make sure you can run everything from that directory. You <b>must</b> be very sure that everything works.
</li>
<li><b>PLEASE</b> do make sure that your work runs on the departmental Linux machines. It will save you much grief later on!
</li>
<li><b>PLEASE</b> do go over the submission instructions carefully, and make sure you did not leave out anything. 
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Mayer Goldberg</p>
<p class="date">Created: 2014-01-23 Thu 11:47</p>
<p class="xhtml-validation"><a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a></p>
</div>
</body>
</html>